<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRIPTIFY - Password Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="Styles/index.css">
    <link rel="stylesheet" href="Styles/passwords.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="Components/navbar.js" defer></script>
</head>
<body data-theme="dark">
    <!-- Background Elements -->
    <div class="cyber-grid"></div>
    <div class="matrix-bg" id="matrix-container"></div>
    <div class="particles" id="particles-container"></div>
    <div class="cyber-circles"></div>
    <div class="glowing-lines"></div>
    <!-- Navbar will be inserted by navbar.js -->
    
    <div class="container mx-auto px-4 py-8 password-container">
        <!-- Header -->
        <header class="password-header">
            <h1 class="password-title">Password Manager</h1>
            <button id="addPasswordBtn" class="primary-btn flex items-center">
                <i class="bi bi-plus-lg mr-2"></i> Add Password
            </button>
        </header>

        <!-- Categories -->
        <div class="categories-container">
            <div class="categories-wrapper">
                <div class="categories-scroll">
                    <button class="category-btn active" data-category="all">All</button>
                    <button class="category-btn" data-category="social">Social</button>
                    <button class="category-btn" data-category="banking">Banking</button>
                    <button class="category-btn" data-category="work">Work</button>
                    <button class="category-btn" data-category="personal">Personal</button>
                </div>
            </div>
        </div>

        <!-- Password Cards Grid -->
        <div id="passwordGrid" class="password-grid">
            <!-- Password cards will be dynamically inserted here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state">
            <i class="bi bi-key text-5xl mb-4"></i>
            <h3 class="empty-title">No passwords saved yet</h3>
            <p class="empty-subtitle">Add your first password to get started</p>
            <button id="addFirstPasswordBtn" class="primary-btn">
                Add Password
            </button>
        </div>

        <!-- Password Form Modal -->
        <div id="passwordModal" class="modal modal-hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalTitle">Add New Password</h3>
                    <button id="closeModalBtn" class="modal-close">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                
                <form id="passwordForm" class="modal-form">
                    <input type="hidden" id="passwordId">
                    
                    <div class="form-group">
                        <label for="website" class="form-label">Website/App Name</label>
                        <input type="text" id="website" required class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label for="username" class="form-label">Username/Email</label>
                        <input type="text" id="username" class="form-input">
                    </div>
                        
                    <div class="form-group">
                        <label for="password" class="form-label">Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="password" required class="form-input">
                            <button type="button" id="togglePassword" class="password-toggle">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        <div class="password-strength-container">
                            <button type="button" id="generatePassword" class="generate-btn">
                                <i class="bi bi-shuffle mr-1"></i> Generate
                            </button>
                            <div class="strength-meter">
                                <div id="passwordStrength" class="strength-bar" style="width: 0%"></div>
                            </div>
                            <span id="strengthText" class="strength-text">Weak</span>
                        </div>
                    </div>
                        
                    <div class="form-group">
                        <label for="category" class="form-label">Category</label>
                        <div class="category-select-wrapper">
                            <select id="category" class="form-select">
                                <option value="social">Social</option>
                                <option value="banking">Banking</option>
                                <option value="work">Work</option>
                                <option value="personal">Personal</option>
                            </select>
                            <input type="text" id="newCategory" placeholder="New category" class="form-input hidden">
                            <button type="button" id="toggleCategory" class="category-add-btn">
                                <i class="bi bi-plus-lg"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="description" class="form-label">Description</label>
                        <textarea id="description" class="form-input" placeholder="Add a description with #hashtags for better searching"></textarea>
                        <p class="text-xs text-gray-500 mt-1">Use #hashtags to make your passwords easier to find</p>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="cancelBtn" class="secondary-btn">Cancel</button>
                        <button type="submit" id="saveBtn" class="primary-btn">Save Password</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="deleteModal" class="modal modal-hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Delete Password</h3>
                    <button id="closeDeleteModalBtn" class="modal-close">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                
                <div class="modal-body">
                    <p class="modal-message">Are you sure you want to delete this password? This action cannot be undone.</p>
                </div>
                
                <div class="modal-footer">
                    <button id="cancelDeleteBtn" class="secondary-btn">Cancel</button>
                    <button id="confirmDeleteBtn" class="danger-btn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="Animations/animations.js"></script>
    <script src="Animations/logo-title-animations.js"></script>
    <script src="Scripts/passwords.js"></script>
    
    <script>
        // Sample data - in a real app, this would come from a database
        let passwords = [
            {
                id: '1',
                website: 'Facebook',
                username: 'user@example.com',
                password: 'P@ssw0rd123',
                category: 'social',
                strength: 'strong',
                description: 'Personal Facebook account #social #personal #facebook'
            },
            {
                id: '2',
                website: 'Bank of America',
                username: 'john.doe',
                password: 'SecureBank123!',
                category: 'banking',
                strength: 'very-strong',
                description: 'Main checking account #banking #finance #important'
            },
            {
                id: '3',
                website: 'Work Email',
                username: 'johndoe@company.com',
                password: 'Company@2023',
                category: 'work',
                strength: 'medium',
                description: 'Company email login #work #email #office'
            }
        ];

        // DOM Elements
        const passwordGrid = document.getElementById('passwordGrid');
        const emptyState = document.getElementById('emptyState');
        const passwordModal = document.getElementById('passwordModal');
        const deleteModal = document.getElementById('deleteModal');
        const passwordForm = document.getElementById('passwordForm');
        
        // Keep search bar visible in navbar
        const modalTitle = document.getElementById('modalTitle');
        const passwordIdInput = document.getElementById('passwordId');
        const websiteInput = document.getElementById('website');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const descriptionInput = document.getElementById('description');
        const categorySelect = document.getElementById('category');
        const newCategoryInput = document.getElementById('newCategory');
        const toggleCategoryBtn = document.getElementById('toggleCategory');
        const togglePasswordBtn = document.getElementById('togglePassword');
        const generatePasswordBtn = document.getElementById('generatePassword');
        const passwordStrengthBar = document.getElementById('passwordStrength');
        const strengthText = document.getElementById('strengthText');
        // Search input is not present in the updated design
        const searchInput = { value: '' }; // Create a dummy object to prevent errors
        const categoryBtns = document.querySelectorAll('.category-btn');

        // State
        let currentCategory = 'all';
        let currentPasswordToDelete = null;
        let isEditing = false;
        let isPasswordVisible = false;

        // Initialize the app
        function init() {
            // Check for search parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const searchParam = urlParams.get('search');
            
            if (searchParam) {
                // Set the search input value to the search parameter
                searchInput.value = searchParam;
            }
            
            updatePasswordGrid();
            setupEventListeners();
            checkEmptyState();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Add password buttons
            document.getElementById('addPasswordBtn').addEventListener('click', () => openPasswordModal());
            document.getElementById('addFirstPasswordBtn').addEventListener('click', () => openPasswordModal());
            
            // Modal buttons
            document.getElementById('closeModalBtn').addEventListener('click', () => closePasswordModal());
            document.getElementById('cancelBtn').addEventListener('click', () => closePasswordModal());
            document.getElementById('closeDeleteModalBtn').addEventListener('click', () => closeDeleteModal());
            document.getElementById('cancelDeleteBtn').addEventListener('click', () => closeDeleteModal());
            document.getElementById('confirmDeleteBtn').addEventListener('click', () => confirmDelete());
            
            // Form submission
            passwordForm.addEventListener('submit', handleFormSubmit);
            
            // Password visibility toggle
            togglePasswordBtn.addEventListener('click', togglePasswordVisibility);
            
            // Generate password
            generatePasswordBtn.addEventListener('click', generateRandomPassword);
            
            // Password strength indicator
            passwordInput.addEventListener('input', updatePasswordStrength);
            
            // Category toggle
            toggleCategoryBtn.addEventListener('click', toggleCategoryInput);
            
            // Search functionality removed as per requirements
            
            // Category buttons
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentCategory = btn.dataset.category;
                    updateActiveCategory();
                    updatePasswordGrid();
                });
            });
        }

        // Update the password grid based on current filters
        function updatePasswordGrid() {
            passwordGrid.innerHTML = '';
            
            let filteredPasswords = [...passwords];
            
            // Filter by category
            if (currentCategory !== 'all') {
                filteredPasswords = filteredPasswords.filter(p => p.category === currentCategory);
            }
            
            // Filter by search term
            const searchTerm = searchInput.value.toLowerCase();
            if (searchTerm) {
                filteredPasswords = filteredPasswords.filter(p => 
                    p.website.toLowerCase().includes(searchTerm) || 
                    (p.username && p.username.toLowerCase().includes(searchTerm)) ||
                    (p.description && p.description.toLowerCase().includes(searchTerm))
                );
            }
            
            // Display passwords
            if (filteredPasswords.length > 0) {
                filteredPasswords.forEach(password => {
                    const passwordCard = createPasswordCard(password);
                    passwordGrid.appendChild(passwordCard);
                });
            }
            
            checkEmptyState();
        }

        // Create a password card element
        function createPasswordCard(password) {
            const card = document.createElement('div');
            card.className = 'password-card bg-white rounded-xl shadow-md overflow-hidden';
            
            // Determine category color
            let categoryColor = 'gray';
            let categoryText = 'Unknown';
            
            switch(password.category) {
                case 'social':
                    categoryColor = 'blue';
                    categoryText = 'Social';
                    break;
                case 'banking':
                    categoryColor = 'green';
                    categoryText = 'Banking';
                    break;
                case 'work':
                    categoryColor = 'purple';
                    categoryText = 'Work';
                    break;
                case 'personal':
                    categoryColor = 'yellow';
                    categoryText = 'Personal';
                    break;
            }
            
            // Determine strength color
            let strengthColor = 'red';
            let strengthText = 'Weak';
            
            switch(password.strength) {
                case 'very-strong':
                    strengthColor = 'green';
                    strengthText = 'Very Strong';
                    break;
                case 'strong':
                    strengthColor = 'green';
                    strengthText = 'Strong';
                    break;
                case 'medium':
                    strengthColor = 'yellow';
                    strengthText = 'Medium';
                    break;
            }
            
            // Function to highlight hashtags in description
            function highlightHashtags(text) {
                if (!text) return '';
                return text.replace(/#(\w+)/g, '<span class="hashtag text-blue-600 font-medium">#$1</span>');
            }
            
            card.innerHTML = `
                <div class="p-6">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${password.website}</h3>
                            ${password.username ? `<p class="text-gray-600 mt-1">${password.username}</p>` : ''}
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium bg-${categoryColor}-100 text-${categoryColor}-700">
                            ${categoryText}
                        </span>
                    </div>
                    
                    <div class="mt-4 flex items-center">
                        <input type="password" value="${password.password}" class="password-display flex-grow px-3 py-2 bg-gray-100 rounded-lg text-gray-800 font-mono" readonly>
                        <button class="toggle-password-btn ml-2 px-3 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300" data-password="${password.password}">
                            <i class="bi bi-eye"></i>
                        </button>
                    </div>
                    
                    <div class="mt-3 flex items-center">
                        <span class="text-xs text-gray-500 mr-2">Strength:</span>
                        <span class="text-xs font-medium text-${strengthColor}-600">${strengthText}</span>
                    </div>
                    
                    ${password.description ? `
                    <div class="mt-3 bg-gray-50 p-2 rounded-lg">
                        <p class="text-sm text-gray-700 description-text">${highlightHashtags(password.description)}</p>
                    </div>
                    ` : ''}
                    
                    <div class="mt-6 flex justify-end space-x-2">
                        <button class="edit-btn px-3 py-1 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200" data-id="${password.id}">
                            <i class="bi bi-edit mr-1"></i> Edit
                        </button>
                        <button class="delete-btn px-3 py-1 bg-red-100 text-red-600 rounded-lg hover:bg-red-200" data-id="${password.id}">
                            <i class="bi bi-trash mr-1"></i> Delete
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listeners to card buttons
            const editBtn = card.querySelector('.edit-btn');
            const deleteBtn = card.querySelector('.delete-btn');
            const toggleBtn = card.querySelector('.toggle-password-btn');
            
            editBtn.addEventListener('click', () => editPassword(password.id));
            deleteBtn.addEventListener('click', () => openDeleteModal(password.id));
            toggleBtn.addEventListener('click', function() {
                const passwordDisplay = this.previousElementSibling;
                if (passwordDisplay.type === 'password') {
                    passwordDisplay.type = 'text';
                    this.innerHTML = '<i class="bi bi-eye-slash"></i>';
                } else {
                    passwordDisplay.type = 'password';
                    this.innerHTML = '<i class="bi bi-eye"></i>';
                }
            });
            
            return card;
        }

        // Check if the password grid is empty and show appropriate state
        function checkEmptyState() {
            if (passwordGrid.children.length === 0) {
                emptyState.classList.remove('hidden');
                passwordGrid.classList.add('hidden');
            } else {
                emptyState.classList.add('hidden');
                passwordGrid.classList.remove('hidden');
            }
        }

        // Open the password modal for adding or editing
        function openPasswordModal(passwordId = null) {
            isEditing = passwordId !== null;
            
            if (isEditing) {
                modalTitle.textContent = 'Edit Password';
                const password = passwords.find(p => p.id === passwordId);
                if (password) {
                    passwordIdInput.value = password.id;
                    websiteInput.value = password.website;
                    usernameInput.value = password.username || '';
                    passwordInput.value = password.password;
                    descriptionInput.value = password.description || '';
                    categorySelect.value = password.category;
                    updatePasswordStrength();
                }
            } else {
                modalTitle.textContent = 'Add New Password';
                passwordForm.reset();
                passwordIdInput.value = '';
                passwordStrengthBar.style.width = '0%';
                strengthText.textContent = 'Weak';
                strengthText.className = 'text-xs ml-2 text-gray-500';
            }
            
            passwordModal.classList.remove('modal-hidden');
        }

        // Close the password modal
        function closePasswordModal() {
            passwordModal.classList.add('modal-hidden');
        }

        // Handle form submission
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const passwordData = {
                website: websiteInput.value.trim(),
                username: usernameInput.value.trim(),
                password: passwordInput.value,
                category: newCategoryInput.classList.contains('hidden') ? 
                    categorySelect.value : 
                    newCategoryInput.value.trim().toLowerCase(),
                strength: getPasswordStrength(passwordInput.value),
                description: descriptionInput.value.trim()
            };
            
            if (isEditing) {
                // Update existing password
                const index = passwords.findIndex(p => p.id === passwordIdInput.value);
                if (index !== -1) {
                    passwords[index] = {
                        ...passwords[index],
                        ...passwordData
                    };
                }
            } else {
                // Add new password
                passwordData.id = Date.now().toString();
                passwords.push(passwordData);
            }
            
            updatePasswordGrid();
            closePasswordModal();
        }

        // Edit a password
        function editPassword(id) {
            openPasswordModal(id);
        }

        // Open delete confirmation modal
        function openDeleteModal(id) {
            currentPasswordToDelete = id;
            deleteModal.classList.remove('modal-hidden');
        }

        // Close delete confirmation modal
        function closeDeleteModal() {
            currentPasswordToDelete = null;
            deleteModal.classList.add('modal-hidden');
        }

        // Confirm password deletion
        function confirmDelete() {
            if (currentPasswordToDelete) {
                passwords = passwords.filter(p => p.id !== currentPasswordToDelete);
                updatePasswordGrid();
                closeDeleteModal();
            }
        }

        // Toggle password visibility
        function togglePasswordVisibility() {
            isPasswordVisible = !isPasswordVisible;
            passwordInput.type = isPasswordVisible ? 'text' : 'password';
            togglePasswordBtn.innerHTML = isPasswordVisible ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
        }

        // Generate a random password
        function generateRandomPassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+';
            let password = '';
            
            for (let i = 0; i < 12; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            passwordInput.value = password;
            updatePasswordStrength();
        }

        // Update password strength indicator
        function updatePasswordStrength() {
            const password = passwordInput.value;
            const strength = getPasswordStrength(password);
            
            let width = 0;
            let color = 'red';
            let text = 'Weak';
            
            switch(strength) {
                case 'very-strong':
                    width = 100;
                    color = 'green';
                    text = 'Very Strong';
                    break;
                case 'strong':
                    width = 80;
                    color = 'green';
                    text = 'Strong';
                    break;
                case 'medium':
                    width = 50;
                    color = 'yellow';
                    text = 'Medium';
                    break;
                case 'weak':
                    width = 25;
                    color = 'red';
                    text = 'Weak';
                    break;
            }
            
            passwordStrengthBar.style.width = `${width}%`;
            passwordStrengthBar.className = `password-strength rounded-full bg-${color}-500`;
            strengthText.textContent = text;
            strengthText.className = `text-xs ml-2 text-${color}-500`;
        }

        // Get password strength
        function getPasswordStrength(password) {
            if (password.length === 0) return 'weak';
            
            // Check for common patterns
            const hasLower = /[a-z]/.test(password);
            const hasUpper = /[A-Z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSpecial = /[^A-Za-z0-9]/.test(password);
            
            let strength = 0;
            
            if (password.length >= 12) strength += 2;
            else if (password.length >= 8) strength += 1;
            
            if (hasLower) strength += 1;
            if (hasUpper) strength += 1;
            if (hasNumber) strength += 1;
            if (hasSpecial) strength += 2;
            
            if (strength >= 6) return 'very-strong';
            if (strength >= 5) return 'strong';
            if (strength >= 3) return 'medium';
            return 'weak';
        }

        // Toggle between category select and input
        function toggleCategoryInput() {
            if (newCategoryInput.classList.contains('hidden')) {
                newCategoryInput.classList.remove('hidden');
                newCategoryInput.value = '';
                toggleCategoryBtn.innerHTML = '<i class="fas fa-chevron-down"></i>';
            } else {
                newCategoryInput.classList.add('hidden');
                toggleCategoryBtn.innerHTML = '<i class="fas fa-plus"></i>';
            }
        }

        // Update active category button styling
        function updateActiveCategory() {
            categoryBtns.forEach(btn => {
                if (btn.dataset.category === currentCategory) {
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    btn.classList.add('bg-blue-600', 'text-white');
                } else {
                    btn.classList.remove('bg-blue-600', 'text-white');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                }
            });
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>